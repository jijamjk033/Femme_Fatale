<%- include('../layouts/headeradmin.ejs') %>

    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                <div class="p-0 d-flex justify-content-between container-fluid">
                    <h1 class="mt-4 mb-3">Add Product</h1>
                </div>
                <form action="/admin/addProduct" method="post" enctype="multipart/form-data" id="product-form"
                onsubmit="return validationChecking()">
                    <section class="content-main">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>Basic</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <label for="product_name" class="form-label">Product name</label>
                                            <input type="text" name="name" placeholder="Type here" class="form-control"
                                                id="product_title">
                                            <div class="error-message" style="color: red;" id="product_title-error">
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label for="product_category" class="form-label">Product category</label>
                                            <select name="category">
                                                <% category.forEach((cat)=> {
                                                    if(cat.is_listed) { %>
                                                    <option value="<%= cat._id %>">
                                                        <%= cat.name %>
                                                    </option>
                                                    <% } }); %>
                                            </select>
                                            <div class="error-message" style="color: red;" id="product_title-error">
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label for="product_price" class="form-label">Price</label>
                                            <input type="text" name="price" placeholder="Type here" class="form-control"
                                                id="product_price">
                                            <div class="error-message" style="color: red;" id="product_price-error">
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label for="product_quantity" class="form-label">Stock</label>
                                            <input type="text" name="stock" placeholder="Type here" class="form-control"
                                                id="product_quantity">
                                            <div class="error-message" style="color: red;" id="product_quantity-error">
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="form-label">Full description</label>
                                            <textarea name="description" id="description" placeholder="Type here"
                                                class="form-control" rows="4"></textarea>
                                            <div class="error-message" style="color: red;" id="description-error"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>Picture</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="input-upload">
                                            <div
                                                style="display: flex; margin-bottom: 20px; justify-content: center; align-items: center;">
                                                <img id="previewImage" src="/assets/images/Products/product.jpeg"
                                                    alt="Default Image" style="width: 100px; height: 100px;">
                                            </div>
                                            <input class="form-control" type="file" name="image" id="product_image"
                                                onchange="validateCategoryImage(this)">
                                            <div class="error-message" style="color: red;" id="product_image-error">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <input type="submit" value="submit"
                                        class="btn btn-primary btn-md rounded font-sm hover-up">
                                </div>
                            </div>
                        </div>
                    </section>
                </form>
                <div style="position: relative; width: 100%;" class="mb-4 justify-content-center text-center">
                    <% if (typeof errorMessage !=='undefined' ) { %>
                        <p
                            style="position: absolute; transform: translate(-50%, -50%); left: 50%; color: crimson; white-space: nowrap;">
                            <%= errorMessage %>
                        </p>
                        <% } %>
                </div>
            </div>
        </main>

        <script>



            document.getElementById('product_image').addEventListener('change', function (event) {
                const file = event.target.files[0];
                const validImageTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/bmp', 'image/webp']; // Add more if needed

                if (file && validImageTypes.includes(file.type)) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('previewImage').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    event.target.value = ""; // Reset the input value to clear the invalid file
                    alert('Please select a valid image file (JPEG, PNG, GIF, BMP)');
                }
            });
        </script>

<script>
    function validationChecking() {
        const product_title = document.getElementById("product_title").value;
        const description = document.getElementById("description").value;
        const product_price = document.getElementById("product_price").value;
        const stock = document.getElementById("product_quantity").value;
        const product_image = document.getElementById("product_image").value;
        const product_category = document.querySelector('select[name="category"]').value.trim();
        

        const product_title_error = document.getElementById("product_title-error");
        const description_error = document.getElementById("description-error");
        const product_price_error = document.getElementById("product_price-error");
        const stock_error = document.getElementById("product_quantity-error");
        const product_image_error = document.getElementById("product_image-error");
        const product_category_error = document.getElementById("product_category-error");
     

        product_title_error.innerHTML = product_title.trim() === "" ? "Please enter product name" : "";
        description_error.innerHTML = description.trim() === "" ? "Please enter product description" : "";
        product_price_error.innerHTML = isNaN(product_price) || product_price.trim() === "" || parseFloat(product_price) < 0 ? "Please enter a valid price" : "";
        stock_error.innerHTML = isNaN(stock) || stock.trim() === "" || parseInt(stock) < 0 ? "Please enter stock quantity" : "";
        product_image_error.innerHTML = product_image.trim() === "" ? "Please upload an image" : "";
        product_category_error.innerHTML = product_category.trim() === "" ? "Please enter product category" : "";
       

        return !(product_title_error.innerHTML !== "" || description_error.innerHTML !== "" || product_price_error.innerHTML !== "" || product_category_error.innerHTML !== "" || stock_error.innerHTML !== "" || product_image_error.innerHTML !== "");
    }
</script>



<!-- ... (remaining HTML code) ... -->

<!-- ... (other HTML code) ... -->



        <%- include('../layouts/footeradmin.ejs') %>